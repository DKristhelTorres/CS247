<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üèÜ Minigame Results</title>
  <style>
    body {
      background: #f8f8f8;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 40px;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 20px;
    }

    #podium {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      height: 300px;
      margin-top: 30px;
      gap: 40px;
    }

    .podium-slot {
      text-align: center;
      position: relative;
      width: 120px;
    }

    .podium-base {
      background: gold;
      width: 100%;
      border-radius: 8px 8px 0 0;
      padding: 10px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }

    .podium-rank-1 .podium-base { height: 150px; background: #ffd700; }
    .podium-rank-2 .podium-base { height: 100px; background: #c0c0c0; }
    .podium-rank-3 .podium-base { height: 75px; background: #cd7f32; }

    .player-sprite {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-bottom: 10px;
    }

    .player-name {
      font-weight: bold;
    }

    .tile-reward {
      font-size: 0.9em;
      color: #555;
    }

    #continue-btn {
      margin-top: 40px;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #eee;
      cursor: pointer;
      transition: background 0.2s;
    }

    #continue-btn:disabled {
      background: #ddd;
      color: #666;
      cursor: wait;
    }

    #continue-btn:hover:enabled {
      background: #ddd;
    }
  </style>
</head>
<body>
  <audio id="podiumSound" src="sounds/bg_podium.mp3"></audio>
  <h1>üèÜ Minigame Results</h1>
  <div id="podium">Waiting for results...</div>
  <button id="continue-btn">Continue</button>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const SERVER_URL = location.hostname === "localhost"
      ? "http://localhost:3000"
      : "https://cs247.onrender.com";

    const socket = io(SERVER_URL);
    let username = localStorage.getItem("username");
    const roomId = localStorage.getItem("roomPassword");

    // Fallback guest name (after connect)
    socket.on("connect", () => {
      if (!username) {
        username = "Guest_" + socket.id.slice(-4);
      }
      if (roomId) {
        console.log(`[RESULTS] Joining vote room ${roomId} as ${username}`);
        socket.emit("joinVoteRoom", roomId);
      }
    });
    console.log("Waiting for mg1Results...");

    // Render podium when results arrive
    socket.on("mg1Results", ({ finishOrder, tileRewards }) => {
      console.log("[CLIENT] mg1Results received!", finishOrder, tileRewards);
      localStorage.setItem("mg1_tileRewards", JSON.stringify(tileRewards));
      const podium = document.getElementById("podium");
      podium.innerHTML = "";

      const medals = ["ü•á", "ü•à", "ü•â"];

      finishOrder.forEach((name, idx) => {
        const playerIdx = (idx % 4) + 1;

        const slot = document.createElement("div");
        slot.className = "podium-slot";
        if (idx < 3) {
          slot.classList.add(`podium-rank-${idx + 1}`);
        }

        // Add medal for top 3
        if (idx < 3) {
          const medal = document.createElement("div");
          medal.textContent = medals[idx];
          medal.style.fontSize = "1.6rem";
          medal.style.marginBottom = "6px";
          slot.appendChild(medal);
        }

        // Sprite image
        const sprite = document.createElement("img");
        sprite.src = `images/Player${playerIdx}.png`;
        sprite.alt = name;
        sprite.className = "player-sprite";
        slot.appendChild(sprite);

        // Podium base for top 3 only
        if (idx < 3) {
          const base = document.createElement("div");
          base.className = "podium-base";
          base.textContent = `#${idx + 1}`; // Show the number
          base.style.fontWeight = "bold";
          base.style.color = "black";
          slot.appendChild(base);
        }

        const label = document.createElement("div");
        label.className = "player-name";
        label.textContent = name;
        slot.appendChild(label);

        const reward = document.createElement("div");
        reward.className = "tile-reward";
        reward.textContent = `+${tileRewards[name]} tiles`;
        slot.appendChild(reward);

        podium.appendChild(slot);
      });
    });


    //   finishOrder.forEach((name, idx) => {
    //     const playerIdx = (idx % 4) + 1;

    //     const slot = document.createElement("div");
    //     slot.className = `podium-slot podium-rank-${idx + 1}`;

    //     const sprite = document.createElement("img");
    //     console.log("Loading sprite from:", sprite.src);
    //     sprite.src = `images/Player${playerIdx}.png`;
    //     sprite.alt = name;
    //     sprite.className = "player-sprite";

    //     const base = document.createElement("div");
    //     base.className = "podium-base";

    //     const label = document.createElement("div");
    //     label.className = "player-name";
    //     label.textContent = name;

    //     const reward = document.createElement("div");
    //     reward.className = "tile-reward";
    //     reward.textContent = `+${tileRewards[name]} tiles`;

    //     slot.appendChild(sprite);
    //     slot.appendChild(base);
    //     slot.appendChild(label);
    //     slot.appendChild(reward);

    //     podium.appendChild(slot);
    //   });
    // });

    // Continue button
    const continueBtn = document.getElementById("continue-btn");
    continueBtn.addEventListener("click", () => {
      continueBtn.disabled = true;
      continueBtn.textContent = "‚è≥ Waiting for other players...";
      socket.emit("resultsSeen", { roomId, username });
    });

    // Redirect once all players are ready
    socket.on("startGameFromServer", ({ tileRewards }) => {
      console.log("[RESULTS] startGameFromServer", tileRewards);
      localStorage.setItem("mg1_tileRewards", JSON.stringify(tileRewards));
      window.location.href = "game-board.html";
    });

  window.addEventListener('click', () => {
    const music = document.getElementById('podiumSound');
    if (music && music.paused) {
        music.play().catch(err => console.warn("Autoplay blocked:", err));
    }
    }, { once: true });
  </script>
</body>
</html>



